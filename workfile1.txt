---
AWSTemplateFormatVersion: '2010-09-09'
Resources:
  IAMRole:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Version: '2012-10-17'
        Statement:
        - Effect: Allow
          Principal:
            Service:
            - lambda.amazonaws.com
            - glue.amazonaws.com
            - athena.amazonaws.com
          Action:
          - sts:AssumeRole
      Path: /
      Policies:
      - PolicyName: s3-full-access
        PolicyDocument:
          Version: '2012-10-17'
          Statement:
          - Effect: Allow
            Action: 's3:*'
            Resource: '*'
      - PolicyName: Lambda-full-access
        PolicyDocument:
          Version: '2012-10-17'
          Statement:
          - Effect: Allow
            Action: 'lambda:*'
            Resource: '*'
      - PolicyName: aws-glue-service-role
        PolicyDocument:
          Version: '2012-10-17'
          Statement:
          - Effect: Allow
            Action:
            - glue:CreateDevEndpoint
            - glue:CreateJob
            - glue:GetDevEndpoint
            - glue:GetJobRun
            - glue:GetJob
            - glue:UpdateDevEndpoint
            Resource: '*'
      - PolicyName: dynamodb-full-access
        PolicyDocument:
          Version: '2012-10-17'
          Statement:
          - Effect: Allow
            Action: 'dynamodb:*'
            Resource: '*'
      - PolicyName: secrets-manager-read-only
        PolicyDocument:
          Version: '2012-10-17'
          Statement:
          - Effect: Allow
            Action:
            - secretsmanager:DescribeSecret
            - secretsmanager:GetSecretValue
            - secretsmanager:ListSecretVersionIds
            Resource: '*'
      - PolicyName: athena-execute-queries
        PolicyDocument:
          Version: '2012-10-17'
          Statement:
          - Effect: Allow
            Action:
            - athena:StartQueryExecution
            - athena:GetQueryExecution
            - athena:StopQueryExecution
            Resource: '*'
