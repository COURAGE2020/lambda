import boto3
import csv
import io

def lambda_handler(event, context):
    # Connect to AWS Lambda
    lambda_client = boto3.client('lambda')

    # Get all the functions in your AWS account
    functions = lambda_client.list_functions()['Functions']

    # Create a list to store the information of each function
    function_list = []
    for function in functions:
        # Get the function details
        function_details = lambda_client.get_function_configuration(FunctionName=function['FunctionName'])

        # Get the required information
        function_info = {}
        function_info['FunctionName'] = function_details['FunctionName']
        function_info['Runtime'] = function_details['Runtime']
        function_info['MemorySize'] = function_details['MemorySize']
        function_info['ProvisionedConcurrency'] = function_details.get('ProvisionedConcurrency', 'N/A')
        function_info['EphemeralStorage'] = function_details.get('XrayConfig', {}).get('OriginalRequest', {}).get('EphemeralStorage', 'N/A')

        # Add the function information to the list
        function_list.append(function_info)

    # Create a file-like buffer to receive PDF data.
    buffer = io.StringIO()

    # Write the function information to a CSV file
    writer = csv.DictWriter(buffer, fieldnames=['FunctionName', 'Runtime', 'MemorySize', 'ProvisionedConcurrency', 'EphemeralStorage'])
    writer.writeheader()
    for function in function_list:
        writer.writerow(function)

    # Connect to AWS S3
    s3_client = boto3.client('s3')

    # Upload the CSV file to the s3 bucket
    s3_client.put_object(Bucket='hellokeke', Key='function_list.csv', Body=buffer.getvalue().encode())
